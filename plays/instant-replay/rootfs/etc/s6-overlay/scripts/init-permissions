#!/command/with-contenv bash
set -e

PUID=${PUID:-1000}
PGID=${PGID:-1000}

echo "[init-permissions] Setting UID=${PUID}, GID=${PGID}"

# Adjust group if needed
CURRENT_GID=$(id -g app 2>/dev/null || echo "")
if [ -n "$CURRENT_GID" ] && [ "$CURRENT_GID" != "$PGID" ]; then
    groupmod -g "$PGID" app
fi

# Adjust user if needed
CURRENT_UID=$(id -u app 2>/dev/null || echo "")
if [ -n "$CURRENT_UID" ] && [ "$CURRENT_UID" != "$PUID" ]; then
    usermod -u "$PUID" app
fi

# Fix ownership
chown -R app:app /data/ipfs /data/minio

echo "[init-permissions] Done"
