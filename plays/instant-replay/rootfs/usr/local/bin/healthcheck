#!/usr/bin/env bash

IPFS_GATEWAY_PORT="${IPFS_GATEWAY_PORT:-8081}"
MINIO_ENABLED="${MINIO_ENABLED:-true}"
MINIO_PORT="${MINIO_PORT:-9000}"

# Check IPFS gateway (empty directory CID â€” always locally available)
if ! curl -sf "http://localhost:${IPFS_GATEWAY_PORT}/ipfs/QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn" > /dev/null; then
    echo "IPFS gateway health check failed"
    exit 1
fi

# Check MinIO (if enabled)
if [ "$MINIO_ENABLED" = "true" ]; then
    if ! curl -sf "http://localhost:${MINIO_PORT}/minio/health/live" > /dev/null; then
        echo "MinIO health check failed"
        exit 1
    fi
fi

exit 0
